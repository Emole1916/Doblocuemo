<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Pro Drift - GLB City Edition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #020205; font-family: 'Segoe UI', sans-serif; }
        #upload-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a1a2e 0%, #000 100%);
            z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center;
        }
        .upload-label {
            background: #ff0055; color: #fff; padding: 15px 40px; border-radius: 50px;
            font-weight: bold; cursor: pointer; border: none; font-size: 20px; transition: 0.3s;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
        }
        .upload-label:hover { transform: scale(1.1); background: #ff2e74; }
        #hud { position: fixed; top: 20px; left: 20px; color: #fff; z-index: 5; background: rgba(0,0,0,0.8); 
               padding: 15px; border-radius: 12px; border-left: 5px solid #ff0055; display: none; min-width: 120px; }
        #controls { position: fixed; bottom: 30px; left: 0; right: 0; display: none; justify-content: space-around; z-index: 5; pointer-events: none; }
        .btn { width: 75px; height: 75px; border-radius: 50%; background: rgba(255,255,255,0.05); 
               color: #fff; display: flex; align-items: center; justify-content: center; 
               font-size: 30px; border: 2px solid rgba(255, 0, 85, 0.4); pointer-events: auto; user-select: none; }
        .btn:active { background: #ff0055; }
    </style>
</head>
<body>

<div id="upload-screen">
    <h1 style="letter-spacing: 5px;">NEON DRIFT</h1>
    <p>Devam etmek iÃ§in <b>.glb</b> uzantÄ±lÄ± araÃ§ modelini seÃ§in</p>
    <label class="upload-label">
        MODELÄ° SEÃ‡ <input type="file" id="fileInput" accept=".glb" style="display:none">
    </label>
</div>

<div id="hud">
    <small>HIZ</small><br>
    <span id="speed" style="font-size: 32px; font-weight: bold; color: #ff0055;">0</span> <small>km/h</small><br>
    <div style="margin-top:5px; border-top:1px solid #333; padding-top:5px;">
        VÄ°TES: <span id="gear" style="font-weight: bold;">D</span>
    </div>
</div>

<div id="controls">
    <div class="btn" id="left">â¬…</div>
    <div class="btn" id="gas">â›½</div>
    <div class="btn" id="brake">ðŸ›‘</div>
    <div class="btn" id="right">âž¡</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158/examples/js/loaders/GLTFLoader.js"></script>

<script>
let scene, camera, renderer, carGroup, isLoaded = false;
let speed = 0, gear = "D", keys = { w:0, s:0, a:0, d:0 };

document.getElementById('fileInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const url = URL.createObjectURL(file);
        initGame(url);
        document.getElementById('upload-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'block';
        document.getElementById('controls').style.display = 'flex';
    }
});

function initGame(modelUrl) {
    // Sahne ve Sis
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020205);
    scene.fog = new THREE.Fog(0x020205, 50, 800);

    camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 2000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.toneMapping = THREE.ACESFilmicToneMapping; // Daha gerÃ§ekÃ§i renkler
    document.body.appendChild(renderer.domElement);

    // IÅŸÄ±klandÄ±rma
    const ambient = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambient);
    
    const neonLight = new THREE.PointLight(0xff0055, 2, 500);
    neonLight.position.set(0, 100, 0);
    scene.add(neonLight);

    // --- GELÄ°ÅžMÄ°Åž HARÄ°TA ---
    // 1. Yol (Asfalt)
    const roadGeo = new THREE.PlaneGeometry(3000, 3000);
    const roadMat = new THREE.MeshStandardMaterial({ color: 0x0a0a0a, roughness: 0.8 });
    const road = new THREE.Mesh(roadGeo, roadMat);
    road.rotation.x = -Math.PI / 2;
    scene.add(road);

    // 2. Neon Grid (Zemin IzgarasÄ±)
    const grid = new THREE.GridHelper(3000, 60, 0xff0055, 0x222222);
    grid.position.y = 0.05;
    scene.add(grid);

    // 3. GÃ¶kdelenler
    const boxGeo = new THREE.BoxGeometry(1, 1, 1);
    for(let i=0; i<400; i++) {
        const h = 30 + Math.random() * 120;
        const w = 20 + Math.random() * 15;
        const b = new THREE.Mesh(boxGeo, new THREE.MeshStandardMaterial({ color: 0x050510 }));
        b.scale.set(w, h, w);
        b.position.set((Math.random()-0.5)*1800, h/2, (Math.random()-0.5)*1800);
        
        // Yolu aÃ§Ä±k tut
        if(Math.abs(b.position.x) < 40) b.position.x += (b.position.x > 0 ? 60 : -60);
        scene.add(b);
    }

    // --- GLB MODEL YÃœKLEME ---
    carGroup = new THREE.Group();
    const loader = new THREE.GLTFLoader();
    loader.load(modelUrl, (gltf) => {
        const model = gltf.scene;
        
        // Model boyutunu ayarla (Model Ã§ok kÃ¼Ã§Ã¼k veya bÃ¼yÃ¼kse burayÄ± deÄŸiÅŸtir)
        model.scale.set(2.5, 2.5, 2.5); 
        model.rotation.y = Math.PI; // Ã–ne bakmasÄ± iÃ§in
        
        carGroup.add(model);
        scene.add(carGroup);
        isLoaded = true;
        animate();
    });
}

// --- FÄ°ZÄ°K MOTORU ---
function update() {
    if(keys.w) speed += (gear === "D" ? 0.015 : -0.012);
    if(keys.s) speed *= 0.93; // Frenleme gÃ¼cÃ¼
    speed *= 0.985; // SÃ¼rtÃ¼nme

    const turnSpeed = 0.045 * (Math.abs(speed) > 0.01 ? 1 : 0);
    if(keys.a) carGroup.rotation.y += turnSpeed * (speed >= 0 ? 1 : -1);
    if(keys.d) carGroup.rotation.y -= turnSpeed * (speed >= 0 ? 1 : -1);

    carGroup.position.x -= Math.sin(carGroup.rotation.y) * speed * 18;
    carGroup.position.z -= Math.cos(carGroup.rotation.y) * speed * 18;

    // Dinamik Kamera (Esnek takip)
    const targetCamX = carGroup.position.x + Math.sin(carGroup.rotation.y) * 55;
    const targetCamZ = carGroup.position.z + Math.cos(carGroup.rotation.y) * 55;
    camera.position.lerp(new THREE.Vector3(targetCamX, 22, targetCamZ), 0.1);
    camera.lookAt(carGroup.position);

    // UI GÃ¼ncelle
    document.getElementById('speed').innerText = Math.abs(speed * 220).toFixed(0);
    document.getElementById('gear').innerText = gear;
}

// --- KONTROLLER ---
window.onkeydown = (e) => {
    const k = e.key.toLowerCase();
    if(k==='w') keys.w=1; if(k==='s') keys.s=1;
    if(k==='a') keys.a=1; if(k==='d') keys.d=1;
    if(e.key===' ') gear = gear === "D" ? "R" : "D";
};
window.onkeyup = (e) => {
    const k = e.key.toLowerCase();
    if(k==='w') keys.w=0; if(k==='s') keys.s=0;
    if(k==='a') keys.a=0; if(k==='d') keys.d=0;
};

// Mobil Buton FonksiyonlarÄ±
const setupBtn = (id, key) => {
    const el = document.getElementById(id);
    el.ontouchstart = (e) => { e.preventDefault(); keys[key]=1; };
    el.ontouchend = () => keys[key]=0;
}
setupBtn('gas','w'); setupBtn('brake','s'); setupBtn('left','a'); setupBtn('right','d');

function animate() {
    requestAnimationFrame(animate);
    if(isLoaded) update();
    renderer.render(scene, camera);
}

window.onresize = () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
};
</script>
</body>
</html>